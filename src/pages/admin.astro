---
// Admin page for Decap CMS
// For local development: run `npx decap-server` in a separate terminal
// For production: uses GitHub OAuth
const base = import.meta.env.BASE_URL;
---
<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Administrace - Pepioli</title>
  <link rel="icon" type="image/svg+xml" href={`${base}favicon.svg`} />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body, #nc-root { height: 100%; width: 100%; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f8f7f5; color: #292524; }
    [data-slate-editor] { min-height: 200px; }
    .cms-loading { position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; background: #f8f7f5; z-index: 9999; opacity: 1; visibility: visible; transition: opacity 0.3s, visibility 0.3s; }
    .cms-loading.hidden { opacity: 0; visibility: hidden; }
    .spinner { width: 40px; height: 40px; border: 4px solid #f5f5f4; border-top-color: #e11d48; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { margin-top: 16px; font-size: 14px; color: #78716c; }
  </style>
</head>
<body>
    <div id="cms-loading" class="cms-loading">
      <div style="text-align: center;">
        <div class="spinner"></div>
        <p class="loading-text">Na캜칤t치n칤 administrace...</p>
      </div>
    </div>
  <div id="nc-root"></div>
  <script is:inline src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script is:inline define:vars={{ base }}>
      // Hide loading when CMS initializes
      window.addEventListener('load', () => {
        const loading = document.getElementById('cms-loading');
        if (loading) setTimeout(() => loading.classList.add('hidden'), 500);
      });
    
    // Initialize CMS with config
    window.CMS_MANUAL_INIT = true;

    CMS.init({
      config: {
        backend: {
          name: 'github',
          repo: 'coldpres/pepioli',
          branch: 'main',
        },
        local_backend: true,
        site_url: 'https://coldpres.github.io/pepioli',
        media_folder: 'public/images/uploads',
        public_folder: `${base}images/uploads`,
        collections: [
          {
            name: 'blog',
            label: '游닇 Blog',
            folder: 'src/content/blog',
            create: true,
            slug: '{{year}}-{{month}}-{{day}}-{{slug}}',
            fields: [
              { label: 'Titulek', name: 'title', widget: 'string' },
              { label: 'Datum', name: 'pubDate', widget: 'datetime', date_format: 'YYYY-MM-DD', time_format: false, format: 'YYYY-MM-DD' },
              { label: 'Popis', name: 'description', widget: 'text' },
              { label: 'Autor', name: 'author', widget: 'string', default: 'Josef칤na Povej코ilov치' },
              { label: 'Extern칤 odkaz', name: 'externalLink', widget: 'string', required: false },
              { label: 'Obsah', name: 'body', widget: 'markdown' }
            ]
          },
          {
            name: 'recipes',
            label: '游꼽 Recepty',
            folder: 'src/content/recipes',
            create: true,
            slug: '{{year}}-{{month}}-{{day}}-{{slug}}',
            fields: [
              { label: 'N치zev receptu', name: 'title', widget: 'string' },
              { label: 'Datum', name: 'pubDate', widget: 'datetime', date_format: 'YYYY-MM-DD', time_format: false, format: 'YYYY-MM-DD' },
              { label: 'Popis', name: 'description', widget: 'text' },
              { label: 'Doba p콏칤pravy', name: 'prepTime', widget: 'string' },
              { label: 'Porce', name: 'servings', widget: 'number', value_type: 'int' },
              { label: 'Ingredience', name: 'ingredients', widget: 'list' },
              { label: 'Postup', name: 'body', widget: 'markdown' }
            ]
          },
          {
            name: 'projects',
            label: '游꿢 Projekty',
            folder: 'src/content/projects',
            create: true,
            slug: '{{slug}}',
            fields: [
              { label: 'N치zev', name: 'title', widget: 'string' },
              { label: 'Popis', name: 'description', widget: 'text' },
              { label: 'Odkaz', name: 'link', widget: 'string', required: false },
              { label: 'Obr치zek', name: 'image', widget: 'image', required: false },
              { label: 'Detail', name: 'body', widget: 'markdown' }
            ]
          }
        ]
      }
    });
  </script>
</body>
</html>
